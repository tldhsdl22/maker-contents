# F-002. 소스 크롤링

## 1. 기능 개요

### 1.1 목적

뉴스 사이트에서 기사를 자동으로 수집하여 원고 생성의 소스로 활용합니다. 기사의 원문 텍스트와 이미지를 HTML 구조 그대로 보존하여 가져옵니다.

### 1.2 핵심 가치

- 화제성 있는 콘텐츠를 자동으로 수집하여 소스 탐색 시간 절감
- 원문의 텍스트와 이미지를 구조적으로 보존하여 원고 생성의 정확도 향상
- 7일간 보관하여 적절한 소스 풀 유지

## 2. 권한 체계

소스 기사 목록은 모든 인증된 사용자(관리자, 일반 사용자)가 조회할 수 있습니다. 크롤링은 시스템이 자동으로 수행하며, 크롤링 대상 사이트는 시스템에 미리 정의되어 있습니다.

## 3. 데이터 항목

### 3.1 기본 정보

각 수집된 기사는 다음 항목을 포함합니다.

- 기사 제목: 원문의 제목을 그대로 저장합니다.
- 썸네일 이미지: 기사의 대표 이미지입니다.
- 원문 URL: 기사의 원본 링크입니다.
- 본문 HTML: 텍스트와 이미지 태그가 포함된 원문 HTML 구조입니다. 예시: `~~했다고 합니다. <img src="~~.jpg"/> 그런데 어쩌고저쩌고 <img src="~~.jpg">`
- 카테고리: 기사의 분류(정치, 경제, 사회, IT, 연예 등)입니다.
- 출처: 수집한 뉴스 사이트명입니다.

### 3.2 시스템 관리 정보

- 수집 일시
- 만료 일시: 수집 후 7일
- 작업 상태: 현재 이 기사를 작업 중인 사용자 목록

## 4. 상세 기능 명세

### 4.1 자동 크롤링

시스템이 1시간 간격으로 뉴스 사이트에서 기사를 자동 수집합니다.

동작 방식:
1. 사전에 정의된 뉴스 사이트 목록을 순회하며 기사를 수집합니다.
2. 기사의 제목, 본문(HTML 포함), 이미지, 카테고리 등을 파싱합니다.
3. 이미 수집된 기사(URL 기준 중복)는 건너뜁니다.
4. 본문에 포함된 이미지는 원본 URL을 보존하되, 별도로 서버에 다운로드하여 저장합니다. 이는 원본 사이트에서 이미지가 삭제될 경우를 대비합니다.
5. 수집 완료 후 새로 추가된 기사 수를 로그에 기록합니다.

예외 처리:
- 크롤링 대상 사이트에 접근이 불가능한 경우 해당 사이트를 건너뛰고 다음 주기에 재시도합니다.
- 파싱에 실패한 기사는 건너뛰고 오류 로그를 남깁니다.

### 4.2 자동 삭제

수집 후 7일이 경과한 기사는 자동으로 삭제됩니다.

동작 방식:
1. 매 크롤링 주기마다 만료된 기사를 확인합니다.
2. 만료된 기사 중 어떤 사용자도 원고 생성에 사용하지 않은 기사를 삭제합니다.
3. 이미 원고 생성에 사용된 기사의 경우, 소스 목록에서는 제거하되 해당 원고의 원본 데이터는 유지합니다.

### 4.3 소스 기사 목록 조회

사용자가 수집된 기사 목록을 조회하여 원고 생성할 기사를 선택합니다.

접근 권한: 모든 인증된 사용자가 사용할 수 있습니다.

동작 방식:
1. 기사 목록을 최신순으로 표시합니다. 각 항목에는 제목, 썸네일, 수집 일시, 출처가 표시됩니다.
2. 카테고리별 필터를 제공합니다.
3. 제목 기반 검색 기능을 제공합니다.
4. 각 기사에 현재 작업 중인 사용자가 있다면 해당 사용자의 이름을 표시합니다. 예: "홍길동 작업 중"
5. 기사를 클릭하면 원문 미리보기와 함께 원고 생성 세팅 화면으로 이동합니다.

표시 규칙:
- 작업 중인 사용자가 있는 기사는 별도 표시(아이콘 또는 뱃지)로 구분합니다.
- 다른 사용자가 작업 중이더라도 동일 기사를 선택하여 작업할 수 있습니다.

## 5. 화면 정보

### S-004 소스 기사 목록 페이지

상단에 검색 바와 카테고리 필터를 배치합니다. 기사 목록은 카드 또는 리스트 형태로 표시하며, 각 카드에 썸네일, 제목, 수집 일시, 출처, 작업 중인 사용자를 표시합니다. 무한 스크롤 또는 페이지네이션으로 목록을 탐색합니다.

## 6. API 정보

- GET /api/sources: 소스 기사 목록 조회 (필터, 검색, 페이지네이션 지원)
- GET /api/sources/:id: 소스 기사 상세 조회 (원문 HTML 포함)

## 7. 비즈니스 로직

- 크롤링 주기: 1시간 간격으로 자동 실행됩니다.
- 보관 기간: 수집일로부터 7일 후 자동 삭제됩니다.
- 중복 방지: 동일 URL의 기사는 중복 수집하지 않습니다.
- 이미지 보존: 원본 이미지를 서버에 별도 저장하여 원본 사이트의 이미지 삭제에 대비합니다.

## 8. 연관 기능

- F-005 원고 생성: 소스 기사를 선택하여 원고를 생성합니다.
- F-006 원고 편집 및 관리: 소스 기사가 원고 생성에 사용된 경우, 기사 만료 후에도 원고의 원본 데이터는 유지합니다.
