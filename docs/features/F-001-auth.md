# F-001. 인증 및 사용자 관리

## 1. 기능 개요

### 1.1 목적

ContentFoundry에 접근하는 사용자를 인증하고, 역할에 따른 권한을 관리합니다. 5~10명 규모의 팀이 사용하므로, 관리자가 사용자를 통제할 수 있는 승인 기반 회원가입 체계를 제공합니다.

### 1.2 핵심 가치

- 관리자 승인을 통한 사용자 접근 통제
- 역할 기반 권한 분리로 시스템 안정성 확보
- 간결한 인증 체계로 빠른 접근

## 2. 권한 체계

### 2.1 역할 정의

시스템은 두 가지 역할을 제공합니다.

**관리자**는 시스템의 전반적인 설정과 사용자를 관리하는 역할입니다. 사용자 관리, 프롬프트 관리, 이미지 처리 템플릿 관리 권한을 가집니다. 관리자도 일반 사용자의 모든 기능(기사 선택, 원고 생성, 포스팅 등)을 사용할 수 있습니다.

**일반 사용자**는 콘텐츠 생산 워크플로우를 수행하는 역할입니다. 소스 기사를 선택하고, 원고를 생성하고, 편집하고, 포스팅하는 모든 과정을 수행합니다.

### 2.2 접근 범위

각 사용자는 자신이 생성한 원고만 조회하고 관리할 수 있습니다. 소스 기사 목록은 모든 사용자가 공유하여 조회합니다. 관리자는 모든 사용자의 원고 및 포스팅 현황을 조회할 수 있습니다.

## 3. 데이터 항목

### 3.1 기본 정보

사용자 계정은 다음 항목으로 구성됩니다.

- 아이디: 로그인에 사용하는 고유 식별자입니다. 영문 소문자와 숫자 조합으로 4~20자까지 허용합니다.
- 이름: 시스템 내에서 표시되는 사용자 이름입니다.
- 비밀번호: 로그인에 사용하는 비밀번호입니다. 8자 이상, 영문과 숫자를 반드시 포함해야 합니다.

### 3.2 시스템 관리 정보

- 역할: 관리자 또는 일반 사용자
- 승인 상태: 대기, 승인, 반려
- 가입 신청일, 승인일
- 최종 로그인 일시

## 4. 상세 기능 명세

### 4.1 회원가입

사용자가 아이디, 이름, 비밀번호를 입력하여 가입을 신청합니다. 가입 신청이 완료되면 "관리자 승인 후 이용 가능합니다"라는 안내 메시지를 표시합니다. 관리자가 승인하기 전까지 해당 계정으로는 로그인할 수 없습니다.

접근 권한: 누구나 가입 신청이 가능합니다.

동작 방식:
1. 사용자가 회원가입 페이지에서 아이디, 이름, 비밀번호, 비밀번호 확인을 입력합니다.
2. 아이디 중복 여부를 실시간으로 확인합니다.
3. 비밀번호와 비밀번호 확인이 일치하는지 검증합니다.
4. 모든 검증을 통과하면 가입 신청을 접수하고 승인 대기 상태로 등록합니다.
5. 관리자에게 새로운 가입 신청이 있음을 알립니다.

예외 처리:
- 아이디가 이미 존재하는 경우 "이미 사용 중인 아이디입니다"를 표시합니다.
- 비밀번호 조건을 충족하지 못하면 구체적인 조건을 안내합니다.
- 비밀번호와 확인이 불일치하면 "비밀번호가 일치하지 않습니다"를 표시합니다.

### 4.2 가입 승인 관리

관리자가 가입 신청 목록을 확인하고 승인 또는 반려합니다.

접근 권한: 관리자만 사용할 수 있습니다.

동작 방식:
1. 관리자 페이지에서 가입 대기 중인 사용자 목록을 확인합니다.
2. 각 신청에 대해 승인 또는 반려를 선택합니다.
3. 승인 시 역할(관리자 또는 일반 사용자)을 지정합니다. 기본값은 일반 사용자입니다.
4. 승인된 사용자는 즉시 로그인이 가능해집니다.

### 4.3 로그인

승인된 사용자가 아이디와 비밀번호로 시스템에 접근합니다.

접근 권한: 승인된 사용자만 로그인할 수 있습니다.

동작 방식:
1. 아이디와 비밀번호를 입력합니다.
2. 인증에 성공하면 대시보드 페이지로 이동합니다.
3. 세션은 일정 시간(예: 24시간) 동안 유지되며, 만료 시 다시 로그인해야 합니다.

예외 처리:
- 아이디 또는 비밀번호가 틀린 경우 "아이디 또는 비밀번호가 올바르지 않습니다"를 표시합니다.
- 승인 대기 상태인 계정으로 로그인 시도 시 "관리자 승인 대기 중입니다"를 표시합니다.
- 반려된 계정으로 로그인 시도 시 "가입이 반려된 계정입니다"를 표시합니다.

### 4.4 사용자 관리

관리자가 전체 사용자 목록을 조회하고, 역할 변경 및 계정 비활성화를 수행합니다.

접근 권한: 관리자만 사용할 수 있습니다.

동작 방식:
1. 전체 사용자 목록을 아이디, 이름, 역할, 상태, 최종 로그인 일시와 함께 표시합니다.
2. 사용자의 역할을 변경(관리자 ↔ 일반 사용자)할 수 있습니다.
3. 계정을 비활성화하여 로그인을 차단할 수 있습니다.

## 5. 화면 정보

### S-001 로그인 페이지

아이디, 비밀번호 입력 필드와 로그인 버튼, 회원가입 링크로 구성됩니다. 심플한 중앙 정렬 레이아웃을 사용합니다.

### S-002 회원가입 페이지

아이디, 이름, 비밀번호, 비밀번호 확인 입력 필드와 가입 신청 버튼으로 구성됩니다.

### S-003 사용자 관리 페이지 (관리자)

가입 대기 목록과 전체 사용자 목록을 탭으로 구분하여 보여줍니다. 각 사용자 행에 승인/반려 버튼 또는 역할 변경, 비활성화 버튼을 표시합니다.

## 6. API 정보

- POST /api/auth/register: 회원가입 신청
- POST /api/auth/login: 로그인
- POST /api/auth/logout: 로그아웃
- GET /api/admin/users: 사용자 목록 조회 (관리자)
- GET /api/admin/users/pending: 가입 대기 목록 조회 (관리자)
- PATCH /api/admin/users/:id/approve: 가입 승인 (관리자)
- PATCH /api/admin/users/:id/reject: 가입 반려 (관리자)
- PATCH /api/admin/users/:id/role: 역할 변경 (관리자)
- PATCH /api/admin/users/:id/deactivate: 계정 비활성화 (관리자)

## 7. 비즈니스 로직

- 첫 번째로 가입한 사용자는 자동으로 관리자 역할이 부여되며 별도 승인 없이 바로 사용 가능합니다.
- 관리자가 1명뿐인 상태에서 해당 관리자의 역할을 변경하거나 비활성화할 수 없습니다.

## 8. 연관 기능

- F-009 대시보드: 로그인 후 대시보드로 이동합니다.
- F-003 프롬프트 관리, F-004 이미지 처리 템플릿 관리: 관리자 권한이 필요합니다.
