# F-005. 원고 생성

## 1. 기능 개요

### 1.1 목적

수집된 소스 기사를 기반으로 AI를 활용하여 사용자가 원하는 스타일의 원고를 자동 생성합니다. 프롬프트 템플릿과 이미지 처리 템플릿을 조합하여, 텍스트와 이미지가 모두 포함된 완성형 원고를 만들어냅니다.

### 1.2 핵심 가치

- 소스 기사를 다양한 톤과 스타일로 빠르게 변환
- 이미지 자동 배치 및 가공으로 완성도 높은 원고 생산
- 키워드 최적화를 통한 검색 노출 향상

## 2. 권한 체계

모든 인증된 사용자(관리자, 일반 사용자)가 원고를 생성할 수 있습니다. 각 사용자는 자신이 생성한 원고만 관리합니다. 같은 소스 기사를 여러 사용자가 각각 다른 설정으로 원고를 생성할 수 있습니다.

## 3. 데이터 항목

### 3.1 생성 설정 (사용자 입력)

- 소스 기사: 원고의 기반이 되는 크롤링된 기사입니다.
- 프롬프트 선택: 적용할 프롬프트 템플릿입니다.
- 이미지 처리 템플릿 선택: 적용할 이미지 가공 방식입니다.
- 키워드 (선택): 원고에 반영할 키워드입니다. 입력하지 않아도 원고 생성이 가능합니다.
- 글 길이: 생성할 원고의 대략적인 길이를 지정합니다. (예: 짧게, 보통, 길게 또는 글자 수 범위)
- 새로운 이미지 생성 개수: 원본 이미지 외에 AI로 추가 생성할 이미지 수를 지정합니다. 기본값은 0입니다.

### 3.2 생성 결과

- 원고 본문: HTML 형태의 완성된 원고입니다. 텍스트와 이미지가 포함됩니다.
- 사용된 이미지 목록: 원본 이미지(가공 후)와 신규 생성 이미지의 목록입니다.
- 생성 설정 기록: 어떤 프롬프트, 이미지 템플릿, 키워드, 글 길이로 생성했는지 기록합니다.

### 3.3 시스템 관리 정보

- 생성 일시
- 생성자(사용자 아이디)
- 원고 상태: 생성 중, 생성 완료, 포스팅 완료

## 4. 상세 기능 명세

### 4.1 원고 생성 세팅

사용자가 소스 기사를 선택한 후 원고 생성에 필요한 설정을 입력합니다.

접근 권한: 모든 인증된 사용자가 사용할 수 있습니다.

동작 방식:
1. 소스 기사 목록에서 기사를 선택하면 생성 세팅 화면으로 이동합니다.
2. 화면 좌측에는 원본 기사의 미리보기(제목, 본문, 이미지)를 표시합니다.
3. 화면 우측에는 설정 패널을 표시합니다.
   - 프롬프트 선택: 드롭다운으로 활성화된 프롬프트 목록을 표시합니다. 각 항목에 프롬프트명과 설명을 표시합니다.
   - 이미지 처리 템플릿 선택: 드롭다운으로 활성화된 템플릿 목록을 표시합니다.
   - 키워드 입력 (선택): 텍스트 입력 필드입니다.
   - 글 길이 선택: 짧게(500자 내외), 보통(1000자 내외), 길게(2000자 내외) 중 선택합니다.
   - 새 이미지 생성 개수: 숫자 입력 필드입니다. 0~10 범위를 허용합니다.
4. "원고 생성" 버튼을 클릭하면 AI 원고 생성을 시작합니다.

### 4.2 AI 원고 생성 처리

사용자가 설정한 옵션에 따라 AI가 원고를 생성하고 이미지를 배치합니다.

동작 방식:
1. 선택한 프롬프트 템플릿의 `{원문}` 변수에 소스 기사의 본문을 삽입하고, `{키워드}` 변수에 입력된 키워드를 삽입합니다.
2. 완성된 프롬프트를 AI(LLM)에 전달하여 원고 텍스트를 생성합니다.
3. 원본 기사의 이미지를 선택한 이미지 처리 템플릿에 따라 가공합니다.
   - 워터마크 제거가 활성화된 경우 워터마크를 먼저 제거합니다.
   - 정의된 처리 방식(유사 제거 리드로잉, 2D 변환, 색상 변환 등)을 적용합니다.
4. 새 이미지 생성 개수가 1 이상인 경우, 이미지 처리 템플릿에 정의된 신규 이미지 생성 방식에 따라 이미지를 생성합니다. 이미지 생성에는 원고의 맥락(주변 텍스트 내용)을 참고하여 관련성 있는 이미지를 만듭니다.
5. AI가 원고의 문맥을 분석하여 이미지를 자연스러운 위치에 자동 배치합니다. 원본 이미지는 원문에서의 상대적 위치를 참고하여 배치하고, 신규 생성 이미지는 텍스트 사이사이에 균등하게 분배합니다.
6. 생성이 완료되면 결과를 편집 화면(F-006)으로 전달합니다.

표시 규칙:
- 생성 중에는 진행 상태를 표시합니다. (예: "원고 생성 중...", "이미지 처리 중...")
- 예상 소요 시간을 안내합니다.

예외 처리:
- AI 원고 생성에 실패한 경우 "원고 생성에 실패했습니다. 다시 시도해 주세요."를 표시하고 재시도 버튼을 제공합니다.
- 이미지 가공/생성에 부분적으로 실패한 경우, 성공한 이미지만 포함하여 원고를 완성하고 실패한 이미지에 대해 안내합니다.
- 원본 기사에 이미지가 없고 새 이미지 생성 개수도 0인 경우, 텍스트만으로 원고를 생성합니다.

## 5. 화면 정보

### S-009 원고 생성 세팅 페이지

좌우 분할 레이아웃입니다. 좌측에는 원본 기사 미리보기를, 우측에는 생성 설정 패널을 배치합니다. 하단에 "원고 생성" 버튼을 배치합니다.

### S-010 원고 생성 중 페이지

생성 진행 상태를 표시하는 화면입니다. 프로그레스 바 또는 단계별 상태 표시를 제공합니다. 생성이 완료되면 자동으로 원고 편집 화면(S-011)으로 이동합니다.

## 6. API 정보

- POST /api/manuscripts/generate: 원고 생성 요청 (소스 ID, 프롬프트 ID, 이미지 템플릿 ID, 키워드, 글 길이, 이미지 생성 개수)
- GET /api/manuscripts/:id/status: 원고 생성 진행 상태 조회

## 7. 비즈니스 로직

- 원고 생성은 비동기로 처리됩니다. 사용자가 생성을 요청하면 작업 큐에 등록되고, 백그라운드에서 처리됩니다.
- 소스 기사에 작업 중인 사용자로 등록됩니다. 원고 생성이 완료되거나 실패하면 작업 중 상태가 해제됩니다.
- 이미지 생성 AI(나노바나나)는 추상화 레이어를 통해 호출하며, 추후 다른 서비스로 교체 가능합니다.
- 글 길이는 정확한 값이 아닌 대략적인 가이드라인이며, AI가 자연스러운 분량으로 조정할 수 있습니다.

## 8. 연관 기능

- F-002 소스 크롤링: 소스 기사를 제공합니다.
- F-003 프롬프트 관리: 원고 스타일 템플릿을 제공합니다.
- F-004 이미지 처리 템플릿 관리: 이미지 가공/생성 방식을 제공합니다.
- F-006 원고 편집 및 관리: 생성된 원고를 편집하고 관리합니다.
